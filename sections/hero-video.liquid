<div class="hero-video">
  <div class="hero-video__container">
    <div class="hero-video__content">
      <video class="hero-video__video" autoplay loop muted playsinline>
        <source src="{{ section.settings.video_url }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Hero Video",
  "settings": [
    {
      "type": "url",
      "id": "video_url",
      "label": "Video URL",
      "info": "MP4 format recommended"
    }
  ],
  "presets": [
    {
      "name": "Hero Video",
      "category": "Video"
    }
  ]
}
{% endschema %}

{% stylesheet %}
.hero-video {
  position: relative;
  width: 100%;
  height: 85vh;
  overflow: hidden;
}

.hero-video__container {
  width: 100%;
  height: 100%;
}

.hero-video__content {
  width: 100%;
  height: 100%;
}

.hero-video__video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.hero-video__placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #f5f5f5;
}

.hero-video__placeholder img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
{% endstylesheet %}

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  // Find the video element with the hero-video__video class
  const videoElement = document.querySelector('.hero-video__video');
  
  // If video element exists, try multiple approaches to force playback
  if (videoElement) {
    // Set initial attributes that help with autoplay
    videoElement.setAttribute('playsinline', '');
    videoElement.setAttribute('webkit-playsinline', '');
    videoElement.setAttribute('x5-playsinline', '');
    videoElement.setAttribute('x5-video-player-type', 'h5');
    videoElement.setAttribute('x5-video-player-fullscreen', 'true');
    videoElement.setAttribute('x5-video-orientation', 'portraint');
    videoElement.setAttribute('preload', 'auto');
    
    // Force muted attribute which is often required for autoplay
    videoElement.muted = true;
    
    // Create a backup video element that we'll use if the main one fails
    const backupVideo = document.createElement('video');
    backupVideo.className = 'hero-video__video-backup';
    backupVideo.style.display = 'none';
    backupVideo.setAttribute('autoplay', '');
    backupVideo.setAttribute('loop', '');
    backupVideo.setAttribute('muted', '');
    backupVideo.setAttribute('playsinline', '');
    backupVideo.setAttribute('webkit-playsinline', '');
    backupVideo.setAttribute('x5-playsinline', '');
    backupVideo.setAttribute('x5-video-player-type', 'h5');
    backupVideo.setAttribute('x5-video-player-fullscreen', 'true');
    backupVideo.setAttribute('x5-video-orientation', 'portraint');
    backupVideo.setAttribute('preload', 'auto');
    
    // Copy the source from the original video
    const originalSource = videoElement.querySelector('source');
    if (originalSource) {
      const newSource = document.createElement('source');
      newSource.src = originalSource.src;
      newSource.type = originalSource.type;
      backupVideo.appendChild(newSource);
    }
    
    // Add the backup video to the DOM
    videoElement.parentNode.appendChild(backupVideo);
    
    // Function to try playing the video with various techniques
    const tryPlayVideo = function(video) {
      // Try direct play
      video.play()
        .catch(error => {
          console.log('Direct play failed:', error);
          
          // Try with a slight delay
          setTimeout(() => {
            video.play()
              .catch(e => console.log('Delayed play failed:', e));
          }, 100);
          
          // Try with a longer delay
          setTimeout(() => {
            video.play()
              .catch(e => console.log('Longer delayed play failed:', e));
          }, 500);
          
          // Try with a much longer delay
          setTimeout(() => {
            video.play()
              .catch(e => console.log('Much longer delayed play failed:', e));
          }, 2000);
        });
    };
    
    // Try playing the original video first
    tryPlayVideo(videoElement);
    
    // Try playing the backup video after a short delay
    setTimeout(() => {
      tryPlayVideo(backupVideo);
    }, 300);
    
    // Create a function to simulate user interaction
    const simulateUserInteraction = function() {
      // Create a fake click event
      const clickEvent = new MouseEvent('click', {
        view: window,
        bubbles: true,
        cancelable: true
      });
      
      // Dispatch the event on the document
      document.dispatchEvent(clickEvent);
      
      // Also try to play the video directly
      videoElement.play().catch(e => console.log('Play after simulated click failed:', e));
      backupVideo.play().catch(e => console.log('Backup play after simulated click failed:', e));
    };
    
    // Try simulating user interaction after a delay
    setTimeout(simulateUserInteraction, 400);
    
    // Try a more aggressive approach - create a new video element dynamically
    setTimeout(() => {
      // Create a completely new video element
      const newVideo = document.createElement('video');
      newVideo.className = 'hero-video__video-new';
      newVideo.style.width = '100%';
      newVideo.style.height = '100%';
      newVideo.style.objectFit = 'cover';
      newVideo.setAttribute('autoplay', '');
      newVideo.setAttribute('loop', '');
      newVideo.setAttribute('muted', '');
      newVideo.setAttribute('playsinline', '');
      newVideo.setAttribute('webkit-playsinline', '');
      newVideo.setAttribute('x5-playsinline', '');
      newVideo.setAttribute('x5-video-player-type', 'h5');
      newVideo.setAttribute('x5-video-player-fullscreen', 'true');
      newVideo.setAttribute('x5-video-orientation', 'portraint');
      newVideo.setAttribute('preload', 'auto');
      
      // Copy the source from the original video
      if (originalSource) {
        const newSource = document.createElement('source');
        newSource.src = originalSource.src + (originalSource.src.includes('?') ? '&' : '?') + 't=' + Date.now();
        newSource.type = originalSource.type;
        newVideo.appendChild(newSource);
      }
      
      // Add the new video to the DOM
      videoElement.parentNode.appendChild(newVideo);
      
      // Try to play the new video
      newVideo.play().catch(e => console.log('New video play failed:', e));
      
      // Hide the original video if the new one plays successfully
      newVideo.addEventListener('playing', function() {
        videoElement.style.display = 'none';
        backupVideo.style.display = 'none';
      });
    }, 600);
    
    // Try using the Intersection Observer API to play when visible
    if ('IntersectionObserver' in window) {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            videoElement.play().catch(e => console.log('Play on intersection failed:', e));
            backupVideo.play().catch(e => console.log('Backup play on intersection failed:', e));
            observer.disconnect();
          }
        });
      }, { threshold: 0.1 });
      
      observer.observe(videoElement);
    }
    
    // Try using the Page Visibility API
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible') {
        videoElement.play().catch(e => console.log('Play on visibility change failed:', e));
        backupVideo.play().catch(e => console.log('Backup play on visibility change failed:', e));
      }
    });
    
    // Try using the requestAnimationFrame API
    let attempts = 0;
    const maxAttempts = 10;
    
    function tryPlayWithRAF() {
      if (attempts < maxAttempts) {
        attempts++;
        requestAnimationFrame(() => {
          videoElement.play().catch(e => console.log(`RAF attempt ${attempts} failed:`, e));
          backupVideo.play().catch(e => console.log(`Backup RAF attempt ${attempts} failed:`, e));
          tryPlayWithRAF();
        });
      }
    }
    
    tryPlayWithRAF();
  }
});
{% endjavascript %} 